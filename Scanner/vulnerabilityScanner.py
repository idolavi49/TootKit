import socket
import os
import sys

def reBanner(ip, port):
    try:
            socket.setdefaulttimeout(2)
            sock = socket.socket()
            sock.connect((ip,port))
            banner = str(sock.recv(1024)).strip("b'{\}rn")
            return banner
    except:
            # banner = "Could not identify"
            return


def checkVulns(banner,filename):
    f = open(filename, "r")
    for line in f.readlines():
        if banner in line:
            print('[+] Server is vulnerable ' + banner)

def main():
    # if len(sys.argv) == 2:
        # filename = sys.argv[1]
    filename = '/tools/Scanner/vulnerFile.txt'
    if not os.path.isfile(filename):
        print('[-] File Doesnt Exist!')
    if not os.access(filename, os.R_OK):
        print('[-] Access Denied!')
        exit(0)

        # else:
        #     print('[-] the Usage:' + str(sys.argv[0]) + " <vuln filename>")
        #     exit(0)


    portlist = [443, 445]
    host = ["10.0.0.8"]
    for ip in host:
        for port in portlist:
            banner = reBanner(ip, port)
            if banner:
                # print("[+] " + ip + "/" + str(port) + " : " + banner)
                print("[+] %s / %d  / %s" % (ip, port, banner))
                checkVulns(banner, filename)
            else:
                print("[+] %s / %d  / Could not identify" % (ip, port))

main()
